<h1>
  <%= @the_playsheet.playsheet_name %> details
</h1>

<article>
  <div>
    <a href="/playsheets">
      Go back
    </a>
  </div>


<% if @the_playsheet.user == current_user %>
  <div>
    <a href="/delete_playsheet/<%= @the_playsheet.id %>">
      Delete playsheet
    </a>
  </div>
  <% end %>
  <dl>
    <dt>
      User
    </dt>
    <dd>
      <%= @the_playsheet.user.email %>
    </dd>

    <dt>
      Playsheet name
    </dt>
    <dd>
      <%= @the_playsheet.playsheet_name %>
    </dd>

    <dt>
      Side of ball
    </dt>
    <dd>
      <%= @the_playsheet.side_of_ball %>
    </dd>

    <dt>
      Playbook
    </dt>
    <dd>
      <%= @the_playsheet.playbook.playbook_name %>
    </dd>

    <dt>
      Created at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_playsheet.created_at) %> ago
    </dd>

    <dt>
      Updated at
    </dt>
    <dd>
      <%= time_ago_in_words(@the_playsheet.updated_at) %> ago
    </dd>
  </dl>
</article>

<article>
  <header>
  <h2>
  Selected Plays in Playsheet
  </h2>
  </header>
  <table>
    <thead>
      <tr>
        <th>Formation</th>      
        <th>Formation Set</th>      
        <th>Play</th>
        <th>Play Art</th>
        <th>Scenario</th>
      </tr>
    </thead>

    <tbody>
      <% @selected_plays.each do |a_play| %>
        <tr>      
          <td>
            <a href="/formations/<%= a_play.formation.id %>">
              <%= a_play.formation.formation_name %>
            </a>
          </td>        
          <td>
            <a href="/formation_sets/<%= a_play.formation_set.id %>">
              <%= a_play.formation_set.formation_set %>
            </a>
          </td>
          <td>
            <a href="/plays/<%= a_play.id %>">
              <%= a_play.play %>
            </a>
          </td>
          <td>
            <a href="/plays/<%= a_play.id %>">
              <img src="<%= a_play.play_art %>" style="width:50px;">
            </a>
          </td>
    
              <td>
  <%= @playsheet_entries[a_play.id]&.scenario&.name || "—" %>
</td>

        </tr>
      <% end %>
    </tbody>
  </table>
</article>


<hr>

<% if @the_playsheet.user == current_user %>
<article>
  <header>
    <h2>
      Edit playsheet
    </h2>
  </header>

  <form action="/modify_playsheet/<%= @the_playsheet.id %>"  method="post" >
    <div>
      <label for="user_id_box">
        User
      </label>

      <input type="text" id="user_id_box" name="query_user_id" value="<%= @the_playsheet.user_id %>">
    </div>

    <div>
      <label for="playsheet_name_box">
        Playsheet name
      </label>

      <input type="text" id="playsheet_name_box" name="query_playsheet_name" value="<%= @the_playsheet.playsheet_name %>">
    </div>

    <div>
      <label for="side_of_ball_box">
        Side of ball
      </label>

      <input type="text" id="side_of_ball_box" name="query_side_of_ball" value="<%= @the_playsheet.side_of_ball %>">
    </div>

    <div>
      <label for="playbook_id_box">
        Playbook
      </label>

      <input type="text" id="playbook_id_box" name="query_playbook_id" value="<%= @the_playsheet.playbook_id %>">
    </div>

    <button type="submit">
      Update playsheet
    </button>
  </form>
</article>

<hr>
<article>
  <%= search_form_for @q,
        url: "/playsheets/#{@the_playsheet.id}",
        method: :get,
        html: { data: { turbo_frame: "plays_list" } } do |f| %>

    <p>Narrow results:</p>

    <div>
      <%= f.label :play_cont, "Name containing" %>
      <%= f.text_field :play_cont, placeholder: "Enter a few characters",
            onchange: "this.form.requestSubmit();" %>
    </div>

    <div>
      <%= f.label :description_cont, "Description containing" %>
      <%= f.text_field :description_cont, placeholder: "Enter a few characters",
            onchange: "this.form.requestSubmit();" %>
    </div>

    <div>
      <%= f.label :formation_set_formation_id_eq, "Formation" %>
      <%= f.select :formation_set_formation_id_eq,
            options_from_collection_for_select(@formations, "id", "formation_name", @q.formation_set_formation_id_eq),
            { include_blank: true },
            { onchange: "this.form.requestSubmit();" } %>
    </div>

    <div>
      <%= f.label :formation_set_id_eq, "Formation Set" %>
      <%= f.select :formation_set_id_eq,
            options_from_collection_for_select(@formation_sets, "id", "formation_set", @q.formation_set_id_eq),
            { include_blank: true },
            { onchange: "this.form.requestSubmit();" } %>
    </div>

    <div>
      <%= check_box_tag "favorites_only", "1", params[:favorites_only] == "1",
            onchange: "this.form.requestSubmit();" %>
      <%= label_tag "favorites_only", "Favorites only" %>
    </div>

    <%= f.submit class: "btn btn-primary btn-block" %>

    <%= link_to "Clear filters",
          url_for({ q: {}, favorites_only: nil, page: nil, path_id: @the_playsheet.id }),
          data: { turbo_frame: "plays_list" } %>
  <% end %>
</article>

<hr>
<%= turbo_frame_tag "plays_list" do %>
  <article>
    <header>
      <h2>Select plays to add to this playsheet</h2>
    </header>

    <form action="/playsheets/<%= @the_playsheet.id %>/add_plays" method="post" data-turbo-frame="_top">
  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
      <table>
        <thead>
          <tr>
            <th>Add?</th>
            <th>Formation</th>
            <th>Formation Set</th>
            <th>Play</th>
            <th>Play Art</th>
          </tr>
        </thead>

        <tbody>
          <% @list_of_plays.each do |a_play| %>
            <tr>
         <td>
  <%= select_tag(
        "scenario_by_play[#{a_play.id}]",
        options_from_collection_for_select(@scenarios, "id", "name"),
        include_blank: "— Select scenario —",
        disabled: @selected_play_ids.include?(a_play.id)
      ) %>
</td>


              <td><%= a_play.formation&.formation_name %></td>
              <td><%= a_play.formation_set&.formation_set %></td>
              <td><%= a_play.play %></td>
              <td>
                <% if a_play.play_art.present? %>
                  <img src="<%= a_play.play_art %>" style="width:250px;">
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <button type="submit">Add selected plays to playsheet</button>
    </form>
  </article>

  <% if @total_pages.to_i > 1 %>
    <article>
      <nav>
        <% if @page > 1 %>
          <%= link_to "Previous",
                url_for(params.permit!.to_h.merge(page: @page - 1)),
                data: { turbo_frame: "plays_list" },
                style: "margin-right: 10px;" %>
        <% end %>

        Page <%= @page %> of <%= @total_pages %>

        <% if @page < @total_pages %>
          <%= link_to "Next",
                url_for(params.permit!.to_h.merge(page: @page + 1)),
                data: { turbo_frame: "plays_list" },
                style: "margin-left: 10px;" %>
        <% end %>
      </nav>
    </article>
  <% end %>
<% end %>
<% end %>
